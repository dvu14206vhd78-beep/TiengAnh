<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tiếng Anh Bài 3</title>
    <style>
      :root {
        --ok: #d4edda;
        --bad: #f8d7da;
        --muted: #666;
        --primary: #0d6efd;
        --secondary: #6c757d;
        --bg: #f4f8fb;
        --card-bg: #fff;
      }
      body {
        font-family: Inter, Roboto, Arial, sans-serif;
        max-width: 1100px;
        margin: 0 auto;
        padding: 0;
        background: var(--bg);
        color: #111;
      }

      /* Top Menu */
      .top-menu {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #e6f7ff;
        padding: 14px 20px;
        border-bottom: 2px solid #d0ebff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .menu-title {
        font-size: 1.25em;
        font-weight: 600;
        color: #0d6efd;
      }

      .menu-buttons {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .menu-buttons .btn {
        padding: 8px 14px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 0.95em;
        font-weight: 500;
        transition: background 0.2s ease, transform 0.1s ease;
      }

      .menu-buttons .btn.primary {
        background: var(--primary);
        color: #fff;
      }

      .menu-buttons .btn.secondary {
        background: var(--secondary);
        color: #fff;
      }

      .menu-buttons .btn:hover {
        opacity: 0.9;
        transform: scale(1.03);
      }

      #scoreDisplay {
        font-weight: 700;
        margin-left: 12px;
        color: #333;
      }

      /* Main Container */
      h1 {
        margin: 20px 0;
        text-align: center;
      }

      h2 {
        margin-top: 30px;
        color: #0d6efd;
        border-bottom: 2px solid #d0ebff;
        padding-bottom: 4px;
      }

      .container {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        margin: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      /* Question block */
      .question {
        padding: 14px;
        border-radius: 10px;
        margin: 14px 0;
        border: 1px solid #eee;
        background: #fafafa;
        transition: 0.2s ease;
      }

      .question:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .q-title {
        font-weight: 600;
        margin-bottom: 8px;
      }

      .options label {
        display: block;
        margin: 8px 0;
        padding: 6px 10px;
        border-radius: 6px;
        transition: background 0.2s ease;
      }

      .options label:hover {
        background: #c5d4fa;
      }

      input[type="text"] {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        width: 100%;
        box-sizing: border-box;
      }

      .answer-key {
        margin-top: 8px;
        font-size: 0.95em;
        color: var(--muted);
      }

      .correct {
        background: var(--ok) !important;
      }

      .incorrect {
        background: var(--bad) !important;
      }

      /* Drag & drop */
      .word-bank {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px;
        border: 1px dashed #ccc;
        border-radius: 8px;
        min-height: 48px;
        background: #fff;
      }

      .word {
        background: #f0f0f0;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: grab;
        border: 1px solid #d0d0d0;
      }

      .dropzone {
        min-height: 48px;
        padding: 8px;
        border: 1px dashed #bbb;
        border-radius: 8px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        background: #fff;
      }

      .small {
        font-size: 0.95em;
        color: var(--muted);
        margin-bottom: 6px;
      }

      .passage {
        background: #fdfdfd;
        border-left: 4px solid #0d6efd;
        padding: 12px;
        margin: 14px 0;
        border-radius: 6px;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <!-- Menu trên cùng -->
    <div class="top-menu">
      <div class="menu-title">Ôn tập Tiếng Anh Bài 3</div>
      <div class="menu-buttons">
        <button class="btn primary" id="showScoreBtn">Xem kết quả</button>
        <button
          class="btn secondary"
          id="redoBtn"
          style="background-color: #111"
        >
          Làm lại & đảo câu
        </button>
        <button class="btn secondary" id="toggleAnsBtn">
          Hiện/ẩn đáp án đúng
        </button>
        <span id="scoreDisplay"></span>
      </div>
    </div>

    <div class="container">
      <h2>Part 1</h2>
      <div id="part1"></div>

      <h2>Part 2</h2>
      <div id="part2"></div>

      <h2>Part 3</h2>
      <div id="part3"></div>

      <h2>Part 4</h2>
      <div id="part4"></div>

      <h2>Part 5</h2>
      <div id="part5"></div>

      <h2>Part 6</h2>
      <div id="part6"></div>
    </div>

    <script>
      // --- Data ---
      const data = {
        part1: [
          {
            id: "p1q1",
            q: "Bạn nên sử dụng dữ liệu di động nếu không có Wi-Fi.",
            opts: [
              "You should use your mobile data when there is no available Wi-Fi.",
              "You might need to charge the phone before using mobile data again.",
              "You must switch off mobile data whenever you see a public Wi-Fi.",
            ],
            ans: 0,
          },
          {
            id: "p1q2",
            q: "Máy tính xách tay của anh ấy mất nhiều thời gian để kết nối với mạng không dây.",
            opts: [
              "His tablet instantly connects to the internet via mobile data.",
              "His desktop doesn’t support any kind of network connection.",
              "His laptop takes longer to connect to the wireless network.",
            ],
            ans: 2,
          },
          {
            id: "p1q3",
            q: "Máy tính bảng của tôi không thể kết nối với mạng Bluetooth.",
            opts: [
              "My laptop connects to Wi-Fi faster than it does to Ethernet cables.",
              "My tablet cannot connect to the Bluetooth network.",
              "My phone doesn’t need Wi-Fi because it uses Bluetooth for everything.",
            ],
            ans: 1,
          },
          {
            id: "p1q4",
            q: "Mạng WiFi ở đây rất yếu và hay bị mất kết nối.",
            opts: [
              "The mobile data is stronger than the WiFi in this building.",
              "The WiFi network here is extremely fast and never gets disconnected.",
              "The WiFi connection in this place is weak and often gets disconnected.",
            ],
            ans: 2,
          },
          {
            id: "p1q5",
            q: "Tớ không thể gửi tin nhắn vì không có tín hiệu di động.",
            opts: [
              "I can't open mobile apps because my phone has no storage left.",
              "I can't send any text messages because there is no mobile signal.",
              "I can't read the messages because my phone battery is fully charged.",
            ],
            ans: 1,
          },
        ],
        part2: [
          {
            id: "p2q1",
            q: "This is the application….. allows users to shares files over mobile networks.",
            opts: ["who", "which", "where"],
            ans: 1,
          },
          {
            id: "p2q2",
            q: "I know an engineer…. designs network systems for mobile service providers.",
            opts: ["which", "where", "who"],
            ans: 2,
          },
          {
            id: "p2q3",
            q: "We installed a system…… connects all smartphone to a secured local network.",
            opts: ["where", "who", "that"],
            ans: 2,
          },
          {
            id: "p2q4",
            q: "The technician .................. helped us fix the internet issue was very professional.",
            opts: ["who", "where", "which"],
            ans: 0,
          },
          {
            id: "p2q5",
            q: "A router is a device .............. sends data to multiple connected computers or phones.",
            opts: ["who", "which", "where"],
            ans: 1,
          },
        ],
        part3: [
          {
            id: "p3q1",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Mobile computing allows people to use computing devices while moving. Smartphones, tablets, and laptops are examples of mobile devices. These devices connect to networks using Wi-Fi, mobile data (3G/4G/5G), or Bluetooth. Mobile computing helps users send emails, attend online meetings, or browse the internet from almost anywhere. This makes work and communication more flexible.",
            q: "Why is mobile computing useful?",
            opts: [
              "It limits users to work in one place.",
              "It only works with desktop computers.",
              "It allows communication from almost anywhere.",
            ],
            ans: 2,
          },
          {
            id: "p3q2",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Wi-Fi is a wireless network technology that connects devices to the internet without cables. Most homes and offices have a Wi-Fi router that sends signals to smartphones, laptops, and other devices. The signal strength depends on the distance from the router and walls or obstacles. A weak signal can cause slow connections or lost internet access.",
            q: "What can affect Wi-Fi signal strength?",
            opts: [
              "The number of apps installed.",
              "The size of the hard drive.",
              "The distance from the router and obstacles.",
            ],
            ans: 2,
          },
          {
            id: "p3q3",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "A hotspot is a physical location where people can access the internet through Wi-Fi. Some smartphones can also create personal hotspots by sharing mobile data. Hotspots are useful when Wi-Fi is not available. However, using mobile data as a hotspot can use a lot of data quickly and drain battery power fast.",
            q: "What is one disadvantage of using a mobile hotspot?",
            opts: [
              "It uses a lot of data and battery.",
              "It cannot connect other devices.",
              "It improves battery life.",
            ],
            ans: 0,
          },
          {
            id: "p3q4",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "A computer network is a group of connected devices that can communicate with each other. These devices include computers, printers, phones, and servers. Networks can be wired, using cables, or wireless, using radio signals. Wireless networks like Wi-Fi are common in homes and public places. Networks allow users to share files, access the internet, and use printers or servers from different devices.",
            q: "What type of network is not commonly used in homes and public places?",
            opts: [
              "Wired network",
              "Satellite network",
              "Wireless network like Wi-Fi",
            ],
            ans: 0,
          },
          {
            id: "p3q5",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Bluetooth is a wireless technology that allows short-range communication between devices. You can use Bluetooth to connect headphones, speakers, or share files between phones. Unlike Wi Fi, Bluetooth works over shorter distances and uses less power. It is ideal for simple tasks like playing music or transferring small files without needing internet access.",
            q: "What is Bluetooth mainly used for?",
            opts: [
              "Sharing large files online",
              "Connecting nearby devices wirelessly",
              "High-speed internet connections",
            ],
            ans: 1,
          },
        ],
        part4: [
          {
            id: "p4q1",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "A wireless network allows devices to connect to the internet without using cables. It uses radio waves to send signals between devices and a router. Wi-Fi is the most common type of wireless network found in homes, schools, and offices. Wireless networks offer flexibility and convenience, but signal strength can drop if there are walls or distance between the device and router.",
            q: "Wireless networks always provide strong signal strength, even if the distance is near or far.",
            type: "tf",
            opts: ["True", "False"],
            ans: 1,
          },
          {
            id: "p4q2",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "Mobile data allows users to connect to the internet without Wi-Fi by using a cellular network. It is commonly used on smartphones and tablets. People use mobile data to browse websites, watch videos, and send emails on the go. However, streaming or downloading large files can use up data quickly, especially if the user has a limited data plan.",
            q: "Mobile data is unlimited for all users by default.",
            type: "tf",
            opts: ["False", "True"],
            ans: 0,
          },
          {
            id: "p4q3",
            instruction:
              "Fill in the blank with THREE or FOUR words from the text to complete the summary.",
            passage:
              "A computer network is a group of devices connected together to share data, files, and various resources. These devices include computers, printers, smartphones, tablets, and servers. Networks can be either wired, using physical cables, or wireless, using radio signals such as Wi-Fi. They are essential for communication, collaboration, internet access, and smooth operation within homes, schools, and workplaces.",
            q: "Summary: Networks allow devices to share data and access the internet. They can ……., depending on the connection type.",
            type: "fill",
            ans: "be wired or wireless",
          },
          {
            id: "p4q4",
            instruction:
              "Fill in the blank with THREE or FOUR words from the text to complete the summary.",
            passage:
              "Wi-Fi is a wireless networking technology that uses radio signals to connect devices such as laptops, smartphones, and tablets to the internet. Most homes, offices, schools, and public places use Wi-Fi routers to provide internet access. However, signal strength can become weaker in areas far from the router or when blocked by thick walls, furniture, or electronic devices.",
            q: "Summary: Wi-Fi connects devices without cables and is widely used in homes and businesses. ….. depends on distance and obstacles.",
            type: "fill",
            ans: "signal strength",
          },
        ],
        part5: [
          {
            id: "p5q1",
            p: "Complete the sentence with TWO or THREE words using the prompt. Use a relative clause (who/that/which).",
            q: "The technician _______ fixed the Wi-Fi in less than an hour. (come/yesterday)",
            ans: "who came yesterday",
          },
          {
            id: "p5q2",
            p: "Complete the sentence with TWO or THREE words using the prompt. Use a relative clause (who/that/which).",
            q: "The laptop _______ strong wireless adapter connects to the network easily. (have)",
            ans: "which has a",
          },
          {
            id: "p5q3",
            p: "Complete the sentence with TWO or THREE words using the prompt. Use a relative clause (who/that/which).",

            q: "The student _______ how computer networks work spoke very clearly and confidently. (explain)",
            ans: "who explained",
          },
          {
            id: "p5q4",
            p: "Complete the sentence with TWO or THREE words using the prompt. Use a relative clause (who/that/which).",
            q: "The app _______ mobile data is useful when traveling abroad. (monitor)",
            ans: "which monitors the",
          },
          {
            id: "p5q5",
            p: "Complete the sentence with TWO or THREE words using the prompt. Use a relative clause (who/that/which).",
            q: "The new modem _______ provides a faster internet connection. (install/ you)",
            ans: "that you installed",
          },
        ],
        part6: [
          {
            id: "p6q1",
            q: "The technician who fixed the router also updated the firewall settings today.",
            words: [
              "The technician",
              "who",
              "also updated",
              "the firewall",
              "fixed the router",
              "settings today.",
            ],
          },
          {
            id: "p6q2",
            q: "The smartphone which you paired with Bluetooth speakers is working very well.",
            words: [
              "The smartphone",
              "which",
              "you paired",
              "with Bluetooth",
              "speakers is",
              "working",
              "very well.",
            ],
          },
          {
            id: "p6q3",
            q: "A wireless hotspot is a location that provides internet access without using cables.",
            words: [
              "A wireless",
              "hotspot",
              "is a location",
              "that provides",
              "internet access",
              "without using cables.",
            ],
          },
          {
            id: "p6q4",
            q: "Devices that are connected to a network can share files and printers.",
            words: [
              "Devices",
              "that are",
              "connected to",
              "a network",
              "can share files",
              "and printers.",
            ],
          },
        ],
      };

      // --- Utility ---
      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      // --- Render Part1 ---
      function renderPart1() {
        const el = document.getElementById("part1");
        el.innerHTML = "";
        data.part1.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part2 ---
      function renderPart2() {
        const el = document.getElementById("part2");
        el.innerHTML = "";
        data.part2.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part3 ---
      function renderPart3() {
        const el = document.getElementById("part3");
        el.innerHTML = "";
        data.part3.forEach((item, idx) => {
          if (item.instruction) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.instruction;
            el.appendChild(instr);
          }
          if (item.passage) {
            const passage = document.createElement("div");
            passage.className = "passage";
            passage.textContent = item.passage;
            el.appendChild(passage);
          }
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part4 ---
      function renderPart4() {
        const el = document.getElementById("part4");
        el.innerHTML = "";
        data.part4.forEach((item, idx) => {
          if (item.instruction) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.instruction;
            el.appendChild(instr);
          }
          if (item.passage) {
            const passage = document.createElement("div");
            passage.className = "passage";
            passage.textContent = item.passage;
            el.appendChild(passage);
          }
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          if (item.type === "tf") {
            const opts = document.createElement("div");
            opts.className = "options";
            item.opts.forEach((opt, i) => {
              const label = document.createElement("label");
              const r = document.createElement("input");
              r.type = "radio";
              r.name = item.id;
              r.value = i;
              label.appendChild(r);
              label.append(" " + opt);
              opts.appendChild(label);
            });
            q.appendChild(opts);
          } else if (item.type === "fill") {
            const inp = document.createElement("input");
            inp.type = "text";
            inp.name = item.id;
            q.appendChild(inp);
          }
          el.appendChild(q);
        });
      }

      // --- Render Part5 ---
      function renderPart5() {
        const el = document.getElementById("part5");
        el.innerHTML = "";
        data.part5.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          if (item.p) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.p;
            q.appendChild(instr);
          }
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const inp = document.createElement("input");
          inp.type = "text";
          inp.name = item.id;
          q.appendChild(inp);
          el.appendChild(q);
        });
      }

      // --- Render Part6 ---
      function renderPart6() {
        const el = document.getElementById("part6");
        el.innerHTML = "";
        data.part6.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          q.dataset.answer = item.q;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 13 + ". Put the words in order.";
          q.appendChild(title);
          const bank = document.createElement("div");
          bank.className = "word-bank";
          bank.dataset.qid = item.id;
          q.appendChild(bank);
          const drop = document.createElement("div");
          drop.className = "dropzone";
          drop.dataset.qid = item.id;
          q.appendChild(drop);
          el.appendChild(q);
          const words = Array.from(item.words);
          shuffle(words);
          words.forEach((w) => {
            const d = document.createElement("div");
            d.className = "word";
            d.draggable = true;
            d.textContent = w;
            d.addEventListener("dragstart", (ev) => {
              ev.dataTransfer.setData(
                "text/plain",
                JSON.stringify({ qid: item.id, text: w, src: "bank" })
              );
            });
            bank.appendChild(d);
          });
          drop.addEventListener("dragover", (ev) => ev.preventDefault());
          drop.addEventListener("drop", (ev) => {
            ev.preventDefault();
            const payload = JSON.parse(ev.dataTransfer.getData("text/plain"));
            const text = payload.text;
            const fromBank = [
              ...document.querySelectorAll("#" + item.id + " .word-bank .word"),
            ];
            let movedEl = fromBank.find((n) => n.textContent === text);
            if (movedEl) {
              const clone = movedEl.cloneNode(true);
              attachDragForPlaced(clone);
              drop.appendChild(clone);
              movedEl.remove();
              // --- Cho phép kéo từ dropzone trả lại word-bank ---
              bank.addEventListener("dragover", (ev) => ev.preventDefault());
              bank.addEventListener("drop", (ev) => {
                ev.preventDefault();
                const payload = JSON.parse(
                  ev.dataTransfer.getData("text/plain")
                );
                const text = payload.text;
                const fromDrop = [
                  ...document.querySelectorAll(
                    "#" + item.id + " .dropzone .word"
                  ),
                ];
                let movedEl = fromDrop.find((n) => n.textContent === text);
                if (movedEl) {
                  const clone = movedEl.cloneNode(true);
                  clone.draggable = true;
                  clone.addEventListener("dragstart", (ev2) => {
                    ev2.dataTransfer.setData(
                      "text/plain",
                      JSON.stringify({ qid: item.id, text: text, src: "bank" })
                    );
                  });
                  bank.appendChild(clone);
                  movedEl.remove();
                }
              });
            }
          });
        });
      }

      function attachDragForPlaced(el) {
        el.addEventListener("dragstart", (ev) => {
          const parentQ = ev.target.closest(".question");
          ev.dataTransfer.setData(
            "text/plain",
            JSON.stringify({
              qid: parentQ.id,
              text: ev.target.textContent,
              src: "placed",
            })
          );
        });
      }

      // --- Check Answers ---
      function checkAnswers() {
        document.querySelectorAll(".question").forEach((q) => {
          q.classList.remove("correct", "incorrect");
          q.querySelectorAll(".answer-key").forEach((a) => a.remove());
        });
        let total = 0,
          correctCount = 0;

        // ---- Part1 ----
        data.part1.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part2 ----
        data.part2.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part3 ----
        data.part3.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part4 ----
        data.part4.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          if (item.type === "tf") {
            const sel = q.querySelector("input[type=radio]:checked");
            if (sel && Number(sel.value) === item.ans) {
              q.classList.add("correct");
              correctCount++;
            } else {
              q.classList.add("incorrect");
              const ak = document.createElement("div");
              ak.className = "answer-key";
              ak.textContent = "Answer: " + item.opts[item.ans];
              q.appendChild(ak);
            }
          } else if (item.type === "fill") {
            const inp = q.querySelector("input");
            const val = inp.value.trim().toLowerCase();
            const ansNorm = item.ans.trim().toLowerCase();
            if (val === ansNorm) {
              q.classList.add("correct");
              correctCount++;
            } else {
              q.classList.add("incorrect");
              const ak = document.createElement("div");
              ak.className = "answer-key";
              ak.textContent = "Answer: " + item.ans;
              q.appendChild(ak);
            }
          }
        });

        // ---- Part5 ----
        data.part5.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const inp = q.querySelector("input");
          const val = inp.value.trim().toLowerCase();
          const ans = item.ans.trim().toLowerCase();
          if (val === ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.ans;
            q.appendChild(ak);
          }
        });

        // ---- Part6 ----
        data.part6.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const drop = q.querySelector(".dropzone");
          const parts = Array.from(drop.children).map((n) =>
            n.textContent.trim()
          );
          const sentence = parts.join(" ").replace(/\s+/g, " ").trim();
          const ansNorm = item.q.replace(/\s+/g, " ").trim();
          const sNorm = sentence.toLowerCase().replace(/\s+/g, " ").trim();
          const aNorm = ansNorm.toLowerCase().replace(/\s+/g, " ").trim();
          if (sNorm === aNorm) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.q;
            q.appendChild(ak);
          }
        });

        // --- Update score ---
        document.getElementById(
          "scoreDisplay"
        ).textContent = `Score: ${correctCount} / ${total}`;
      }

      // --- Reset ---
      function resetAll() {
        document.getElementById("scoreDisplay").textContent = "";
        renderAll();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // --- Render All ---
      function renderAll() {
        renderPart1();
        renderPart2();
        renderPart3();
        renderPart4();
        renderPart5();
        renderPart6();
      }

      // --- Init ---
      renderAll();

      // --- Menu buttons ---
      document.getElementById("showScoreBtn").onclick = () => checkAnswers();
      document.getElementById("redoBtn").onclick = () => resetAll();
      document.getElementById("toggleAnsBtn").onclick = () => {
        if (!document.querySelector(".answer-key")) {
          checkAnswers();
        }
        document.querySelectorAll(".answer-key").forEach((el) => {
          el.style.display =
            el.style.display === "none" || el.style.display === ""
              ? "block"
              : "none";
        });
      };
    </script>
  </body>
</html>
