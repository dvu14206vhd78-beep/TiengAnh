<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tiếng Anh Bài 2</title>
    <script type="text/javascript" src="https://me.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=bmam_JnX6Pf-7oxWHK_dSy0yBE8c8LRocvd5ECd7k-0aZyCqL_pnRGZL2viVXYPeARC7KC-swd_V2CIUk__wfiq8kSUNJRZK2PgcRWIpuzOpMEXdpV8qsiMkQyYPcRSvrr_b7TBbqJr3BCeehYbbZ594ZlKIVXVW9sLBjJXnKkkgPmecaEXqzimwZKm4Yu1gfpJccKLyvZIStn0bG0FHh28QmmHBsxx9f1AiesPgCDGBVITj40wI1lhunhMTrcpE1dBaVng-GgOrWF5LSxyim1iDeWZbxSzwJ5Gsfk077SBqsoNrzoDAhigiPGcBWZoVOIqCGKonSQETJsHoMc8tGgHYRX4horll3H2z0SLkAy1D49F5zgWT3faQ9V9U1WEqSoOT35PMSJeLLVHSOf3nenTKp9_5Ae7MHuiAwb8ewWo7JQwz59vzK88_huaazgv8QxkYO0NEVbUHWQirgn5ukkeYZdwRlSOjEt3Xs0GIbCo8EHLQ7DRKdOWj0USQUq7NCFHmk9pWhfFvJQeCmsTgTi3FwSFCfdwJ57ws2BSad-XZWP2_rBIB_wtd0PqRnruiMAgWdwn0jE33S0YZj-zuIi0pAF39v050xPY_CbcmOLGamdt09qAkSJFeVovaEvd56XyN_vvmpjh9xiRC5LaFSAizwR6-fnF-jRXa2VOW6EzFMQQQiDiYIi8-j6fY_2yW" charset="UTF-8"></script><link rel="stylesheet" crossorigin="anonymous" href="https://me.kis.v2.scr.kaspersky-labs.com/E3E8934C-235A-4B0E-825A-35A08381A191/abn/main.css?attr=aHR0cHM6Ly9jZG4uZmJzYnguY29tL3YvdDU5LjI3MDgtMjEvNTYzMjk4NDkxXzE0NzUxNTM5MjcwNzQ3OTJfODQyMDg0ODQ3NjY0MDE1OTU3OF9uLmh0bWwvQmFpMi5odG1sP19uY19jYXQ9MTA5JmNjYj0xLTcmX25jX3NpZD0yYjBlMjImX25jX2V1aTI9QWVIZk0zMEhTTmpHQ3YwU25NQVA5enBMZUZHQ2VOeXY2RFY0VVlKNDNLX29OWEVoZjc5WVBGdS14X25CS1BvME5tZHdBY3JIQ2NmalVkdDdBZEtOaTdpUSZfbmNfb2hjPURMSk96WGx0d0RrUTdrTnZ3SGVQMmFnJl9uY19vYz1BZG5XcEhPM09QbF9TUTBXMk1zV2YzSUxlemZIVnFDeWtIakpSN29oTUJjTUd4XzJxRHBzWlV4cm16SXEtUlVMSExTV1ZsV09EeDRTdjNHdU90amhTNkdJJl9uY196dD03Jl9uY19odD1jZG4uZmJzYnguY29tJl9uY19naWQ9QVJHQUlTcnFPQTlOZHNheFRzdTF4dyZvaD0wM19RN2NEM2dFNVZqMXo1d0EwMFlBSkNZTTZzaTloa0twazlIV01PSXpTVU9BZmNmM3VodyZvZT02OEVDMzUxOSZkbD0x"/><style>
      :root {
        --ok: #d4edda;
        --bad: #f8d7da;
        --muted: #666;
        --primary: #0d6efd;
        --secondary: #6c757d;
        --bg: #f4f8fb;
        --card-bg: #fff;
      }
      body {
        font-family: Inter, Roboto, Arial, sans-serif;
        max-width: 1100px;
        margin: 0 auto;
        padding: 0;
        background: var(--bg);
        color: #111;
      }

      /* Top Menu */
      .top-menu {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #e6f7ff;
        padding: 14px 20px;
        border-bottom: 2px solid #d0ebff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .menu-title {
        font-size: 1.25em;
        font-weight: 600;
        color: #0d6efd;
      }

      .menu-buttons {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .menu-buttons .btn {
        padding: 8px 14px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 0.95em;
        font-weight: 500;
        transition: background 0.2s ease, transform 0.1s ease;
      }

      .menu-buttons .btn.primary {
        background: var(--primary);
        color: #fff;
      }

      .menu-buttons .btn.secondary {
        background: var(--secondary);
        color: #fff;
      }

      .menu-buttons .btn:hover {
        opacity: 0.9;
        transform: scale(1.03);
      }

      #scoreDisplay {
        font-weight: 700;
        margin-left: 12px;
        color: #333;
      }

      /* Main Container */
      h1 {
        margin: 20px 0;
        text-align: center;
      }

      h2 {
        margin-top: 30px;
        color: #0d6efd;
        border-bottom: 2px solid #d0ebff;
        padding-bottom: 4px;
      }

      .container {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        margin: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      /* Question block */
      .question {
        padding: 14px;
        border-radius: 10px;
        margin: 14px 0;
        border: 1px solid #eee;
        background: #fafafa;
        transition: 0.2s ease;
      }

      .question:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .q-title {
        font-weight: 600;
        margin-bottom: 8px;
      }

      .options label {
        display: block;
        margin: 8px 0;
        padding: 6px 10px;
        border-radius: 6px;
        transition: background 0.2s ease;
      }

      .options label:hover {
        background: #f1f5ff;
      }

      input[type="text"] {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        width: 100%;
        box-sizing: border-box;
      }

      .answer-key {
        margin-top: 8px;
        font-size: 0.95em;
        color: var(--muted);
      }

      .correct {
        background: var(--ok) !important;
      }

      .incorrect {
        background: var(--bad) !important;
      }

      /* Drag & drop */
      .word-bank {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px;
        border: 1px dashed #ccc;
        border-radius: 8px;
        min-height: 48px;
        background: #fff;
      }

      .word {
        background: #f0f0f0;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: grab;
        border: 1px solid #d0d0d0;
      }

      .dropzone {
        min-height: 48px;
        padding: 8px;
        border: 1px dashed #bbb;
        border-radius: 8px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        background: #fff;
      }

      .small {
        font-size: 0.95em;
        color: var(--muted);
        margin-bottom: 6px;
      }

      .passage {
        background: #fdfdfd;
        border-left: 4px solid #0d6efd;
        padding: 12px;
        margin: 14px 0;
        border-radius: 6px;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <!-- Menu trên cùng -->
    <div class="top-menu">
      <div class="menu-title">Ôn tập Tiếng Anh Bài 2</div>
      <div class="menu-buttons">
        <button class="btn primary" id="showScoreBtn">Xem kết quả</button>
        <button
          class="btn secondary"
          id="redoBtn"
          style="background-color: #111"
        >
          Làm lại & đảo câu
        </button>
        <button class="btn secondary" id="toggleAnsBtn">
          Hiện/ẩn đáp án đúng
        </button>
        <span id="scoreDisplay"></span>
      </div>
    </div>

    <div class="container">
      <h2>Part 1</h2>
      <div id="part1"></div>

      <h2>Part 2</h2>
      <div id="part2"></div>

      <h2>Part 3</h2>
      <div id="part3"></div>

      <h2>Part 4</h2>
      <div id="part4"></div>

      <h2>Part 5</h2>
      <div id="part5"></div>

      <h2>Part 6</h2>
      <div id="part6"></div>
    </div>

    <script>
      // --- Data ---
      const data = {
        part1: [
          {
            id: "p1q1",
            q: "Máy tính của tôi tự động cài đặt bản cập nhật khi khởi động lại.",
            opts: [
              "My computer automatically installs updates when shutting down.",
              "My computer automatically installs updates when restarting",
              "My computer manually installs updates when restarting",
            ],
            ans: 1,
          },
          {
            id: "p1q2",
            q: "Trình duyệt web này hỗ trợ nhiều thẻ cùng lúc",
            opts: [
              "This web browser downloads multiple files at once",
              "This web browser deletes multiple tabs at once",
              "This web browser supports multiple tabs at once.",
            ],
            ans: 2,
          },
          {
            id: "p1q3",
            q: "Trình duyệt của tôi lưu mật khẩu để đăng nhập nhanh hơn",
            opts: [
              "My browser deletes passwords to log in faster",
              "My browser saves passwords for quicker logins",
              "My browser hides passwords to protect data",
            ],
            ans: 1,
          },
          {
            id: "p1q4",
            q: "Tôi cần đánh dấu trang web này để đọc sau.",
            opts: [
              "I need to sync this website to read later",
              "I need to bookmark this website to read later",
              "I need to refresh this website to read later.",
            ],
            ans: 1,
          },
          {
            id: "p1q5",
            q: "Hệ điều hành Windows 10 đã phát hành năm 2015.",
            opts: [
              "The Windows 10 operating system was released in 2015",
              "The Windows 10 browser was updated in 2015.",
              "The Windows 10 operating system will release in 2015",
            ],
            ans: 0,
          },
        ],

        part2: [
          {
            id: "p2q1",
            q: "Right now, the system…. for updates to install the latest version.",
            opts: ["checks", "checking", "is checking"],
            ans: 2,
          },
          {
            id: "p2q2",
            q: "Many people…. private browsing when they visit websites on public computers.",
            opts: ["are used", "use", "is using "],
            ans: 1,
          },
          {
            id: "p2q3",
            q: "She….. her laptop to the internet through a mobile hotspot at the moment",
            opts: ["is connecting", "connect", "connects"],
            ans: 0,
          },
          {
            id: "p2q4",
            q: "My computer __________ slowly because too many programs are running in the background.",
            opts: ["running", "is running", "works"],
            ans: 1,
          },
          {
            id: "p2q5",
            q: "The user usually __________ the browser before checking emails or visiting websites.",
            opts: ["open", "is opening", "opens"],
            ans: 2,
          },
        ],

        part3: [
          {
            id: "p3q1",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Cookies are small files that websites store on your computer to collect and remember information. They help websites remember user settings, login details, and shopping cart items. While cookies can be helpful for a smoother browsing experience, having too many may slow down your browser. You can delete cookies anytime from your browser's settings menu to improve speed and performance.",
            q: "What is one purpose of cookies?",
            opts: [
              "To store user settings",
              "To increase download speed",
              "To upgrade the browser",
            ],
            ans: 0,
          },
          {
            id: "p3q2",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Updates to operating systems and web browsers fix bugs, improve performance, and strengthen security. These regular updates may also include useful new features or tools and help protect your device from malware, viruses, or hackers. If you ignore updates, your system might become slow, outdated, or unsafe. Most modern devices allow automatic updates to save time and effort.",
            q: "Why are updates important?",
            opts: [
              "They delete your files",
              "They fix bugs and improve security",
              "They make the device slower.",
            ],
            ans: 1,
          },
          {
            id: "p3q3",
            instruction:
              "Read the passage and choose the correct answer to  R  ahe question.",
            passage:
              "An operating system that supports multitasking lets you run several programs at the same time. For example, you can listen to music, write a document, and browse the internet without closing any of them. Without multitasking, only one application could run at a time, which slows down productivity.",
            q: "Why is multitasking useful?",
            opts: [
              "It increases screen brightness",
              "It makes the computer smaller",
              "It allows many programs to run at once",
            ],
            ans: 2,
          },
          {
            id: "p3q4",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Internet browsing is done through applications called web browsers. These include Chrome, Firefox, Safari, and Edge. Browsers allow users to visit websites, watch videos, and download files. They also save passwords and browsing history if allowed. To protect privacy, users can enable private browsing, which does not store history or cookies.",
            q: "What does private browsing do?",
            opts: [
              "It does not store history or cookies",
              "It saves browsing history",
              "It stores passwords",
            ],
            ans: 0,
          },
          {
            id: "p3q5",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Operating systems control the basic functions of a computer. They manage hardware like the CPU, memory, and storage devices. Without an operating system, a computer cannot run programs or communicate with connected devices. Windows, macOS, and Linux are examples of operating systems used on personal computers and laptops.",
            q: "What does an operating system help manage?",
            opts: [
              "Only software",
              "Only the display screen",
              "Hardware and basic functions",
            ],
            ans: 2,
          },
        ],

        part4: [
          {
            id: "p4q1",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "Most modern operating systems come with built-in security features such as firewalls and automatic updates. These tools help protect the system from viruses, malware, and other online threats. Users should keep these features enabled and regularly update their system to ensure the highest level of protection.",
            q: "Built-in security features in modern operating systems protect them against online threats.",
            type: "tf",
            opts: ["True", "False"],
            ans: 0,
          },
          {
            id: "p4q2",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "Operating systems provide a platform for running software and managing hardware devices like printers, keyboards, and storage drives. Without an operating system, most computers cannot function. Operating systems also offer tools for file management and security. Users often choose an OS based on personal needs and the type of software they plan to use.",
            q: "A computer can work properly without an operating system.",
            type: "tf",
            opts: ["True", "False"],
            ans: 1,
          },

          {
            id: "p4q3",
            instruction:
              "Fill in the blank with TWO OR THREE words from the text to complete the summary.",
            passage:
              "An operating system update improves the security and performance of a computer. Updates may include bug fixes, new features, or protection against the latest viruses and threats. Keeping your OS up to date ensures the system runs efficiently and safely. Most systems can be set to update automatically in the background.",
            q: "Summary: Updating the operating system helps improve security, fixes bugs, updates new features and makes they system work .........",
            type: "fill",
            ans: "efficiently and safely",
          },
          {
            id: "p4q4",
            instruction:
              "Fill in the blank with TWO OR THREE words from the text to complete the summary.",
            passage:
              "A search engine helps users find information online by showing a list of websites that match the keywords entered. Google, Bing, and Yahoo are some of the most popular search engines. Using clear and specific keywords gives better results. Search engines are essential tools for internet browsing and learning, making it easier and faster to access knowledge anytime.",
            q: "Summary : A search engine finds websites based on keywords and is an important tool for…. and online research.",
            type: "fill",
            ans: "internet browsing",
          },
          {
            id: "p4q5",
            instruction:
              "Fill in the blank with TWO OR THREE words from the text to complete the summary.",
            passage:
              "Most internet browsers offer a feature called private browsing or incognito mode. When using this mode, the browser does not save your history, cookies, or login details. This is useful when using a shared computer or when users want to keep their browsing activity private. However, private browsing does not make users completely anonymous online.",
            q: "Summary: Private browsing prevents the browser from saving history or cookies, helping users protect their __________ on shared devices.",
            type: "fill",
            ans: "browsing activity",
          },
        ],

        part5: [
          {
            id: "p5q1",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompt.",
            q: "He is clearing the browser cache ___________________ faster. (website/ load)",
            ans: "so that websites load",
          },
          {
            id: "p5q2",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompt.",
            q: "You should restart the computer ___________________ the installation. (complete)",
            ans: "in order to complete",
          },
          {
            id: "p5q3",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompt.",
            q: "The technician is installing a new firewall __________ system. (protect)",
            ans: "to protect the",
          },
          {
            id: "p5q4",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompt.",
            q: "The user updates the browser regularly __________ safe online. (stay)",
            ans: "to stay",
          },
          {
            id: "p5q5",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompt.",
            q: "The app runs in the background ___________________ manage battery usage. (help)",
            ans: "to help",
          },
        ],

        part6: [
          {
            id: "p6q1",
            q: "The system usually installs updates automatically when a new version is available.",
            words: [
              "usually installs",
              "updates automatically",
              "version is",
              "when a new",
              "The system",
              "available.",
            ],
          },
          {
            id: "p6q2",
            q: "The user is clicking on the link to open the settings page.",
            words: [
              "open the",
              "The user is",
              "settings page.",
              "the link to",
              "clicking on",
            ],
          },
          {
            id: "p6q3",
            q: "Browsers store data so that websites load faster during future visits.",
            words: [
              "Browsers store",
              "websites load",
              "future visits.",
              "data so that",
              "faster during",
            ],
          },
          {
            id: "p6q4",
            q: "The browser is loading several tabs with video content right now.",
            words: [
              "content right",
              "with video",
              "now.",
              "The browser",
              "several tabs",
              "is loading",
            ],
          },
          {
            id: "p6q5",
            q: "Most computers use operating system to support multiple user and applications.",
            words: [
              "use operating",
              "users and applications.",
              "support multiple",
              "Most computers",
              "system to",
            ],
          },
        ],
      };

      // --- Utility ---
      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      // --- Render Part1 ---
      function renderPart1() {
        const el = document.getElementById("part1");
        el.innerHTML = "";
        data.part1.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part2 ---
      function renderPart2() {
        const el = document.getElementById("part2");
        el.innerHTML = "";
        data.part2.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part3 ---
      function renderPart3() {
        const el = document.getElementById("part3");
        el.innerHTML = "";
        data.part3.forEach((item, idx) => {
          if (item.instruction) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.instruction;
            el.appendChild(instr);
          }
          if (item.passage) {
            const passage = document.createElement("div");
            passage.className = "passage";
            passage.textContent = item.passage;
            el.appendChild(passage);
          }
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part4 ---
      function renderPart4() {
        const el = document.getElementById("part4");
        el.innerHTML = "";
        data.part4.forEach((item, idx) => {
          if (item.instruction) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.instruction;
            el.appendChild(instr);
          }
          if (item.passage) {
            const passage = document.createElement("div");
            passage.className = "passage";
            passage.textContent = item.passage;
            el.appendChild(passage);
          }
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          if (item.type === "tf") {
            const opts = document.createElement("div");
            opts.className = "options";
            item.opts.forEach((opt, i) => {
              const label = document.createElement("label");
              const r = document.createElement("input");
              r.type = "radio";
              r.name = item.id;
              r.value = i;
              label.appendChild(r);
              label.append(" " + opt);
              opts.appendChild(label);
            });
            q.appendChild(opts);
          } else if (item.type === "fill") {
            const inp = document.createElement("input");
            inp.type = "text";
            inp.name = item.id;
            q.appendChild(inp);
          }
          el.appendChild(q);
        });
      }

      // --- Render Part5 ---
      function renderPart5() {
        const el = document.getElementById("part5");
        el.innerHTML = "";
        data.part5.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          if (item.p) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.p;
            q.appendChild(instr);
          }
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const inp = document.createElement("input");
          inp.type = "text";
          inp.name = item.id;
          q.appendChild(inp);
          el.appendChild(q);
        });
      }

      // --- Render Part6 ---
      function renderPart6() {
        const el = document.getElementById("part6");
        el.innerHTML = "";
        data.part6.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          q.dataset.answer = item.q;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 13 + ". Put the words in order.";
          q.appendChild(title);
          const bank = document.createElement("div");
          bank.className = "word-bank";
          bank.dataset.qid = item.id;
          q.appendChild(bank);
          const drop = document.createElement("div");
          drop.className = "dropzone";
          drop.dataset.qid = item.id;
          q.appendChild(drop);
          el.appendChild(q);
          const words = Array.from(item.words);
          shuffle(words);
          words.forEach((w) => {
            const d = document.createElement("div");
            d.className = "word";
            d.draggable = true;
            d.textContent = w;
            d.addEventListener("dragstart", (ev) => {
              ev.dataTransfer.setData(
                "text/plain",
                JSON.stringify({ qid: item.id, text: w, src: "bank" })
              );
            });
            bank.appendChild(d);
          });
          drop.addEventListener("dragover", (ev) => ev.preventDefault());
          drop.addEventListener("drop", (ev) => {
            ev.preventDefault();
            const payload = JSON.parse(ev.dataTransfer.getData("text/plain"));
            const text = payload.text;
            const fromBank = [
              ...document.querySelectorAll("#" + item.id + " .word-bank .word"),
            ];
            let movedEl = fromBank.find((n) => n.textContent === text);
            if (movedEl) {
              const clone = movedEl.cloneNode(true);
              attachDragForPlaced(clone);
              drop.appendChild(clone);
              movedEl.remove();
              // --- Cho phép kéo từ dropzone trả lại word-bank ---
              bank.addEventListener("dragover", (ev) => ev.preventDefault());
              bank.addEventListener("drop", (ev) => {
                ev.preventDefault();
                const payload = JSON.parse(
                  ev.dataTransfer.getData("text/plain")
                );
                const text = payload.text;
                const fromDrop = [
                  ...document.querySelectorAll(
                    "#" + item.id + " .dropzone .word"
                  ),
                ];
                let movedEl = fromDrop.find((n) => n.textContent === text);
                if (movedEl) {
                  const clone = movedEl.cloneNode(true);
                  clone.draggable = true;
                  clone.addEventListener("dragstart", (ev2) => {
                    ev2.dataTransfer.setData(
                      "text/plain",
                      JSON.stringify({ qid: item.id, text: text, src: "bank" })
                    );
                  });
                  bank.appendChild(clone);
                  movedEl.remove();
                }
              });
            }
          });
        });
      }

      function attachDragForPlaced(el) {
        el.addEventListener("dragstart", (ev) => {
          const parentQ = ev.target.closest(".question");
          ev.dataTransfer.setData(
            "text/plain",
            JSON.stringify({
              qid: parentQ.id,
              text: ev.target.textContent,
              src: "placed",
            })
          );
        });
      }

      // --- Check Answers ---
      function checkAnswers() {
        document.querySelectorAll(".question").forEach((q) => {
          q.classList.remove("correct", "incorrect");
          q.querySelectorAll(".answer-key").forEach((a) => a.remove());
        });
        let total = 0,
          correctCount = 0;

        // ---- Part1 ----
        data.part1.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part2 ----
        data.part2.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part3 ----
        data.part3.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part4 ----
        data.part4.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          if (item.type === "tf") {
            const sel = q.querySelector("input[type=radio]:checked");
            if (sel && Number(sel.value) === item.ans) {
              q.classList.add("correct");
              correctCount++;
            } else {
              q.classList.add("incorrect");
              const ak = document.createElement("div");
              ak.className = "answer-key";
              ak.textContent = "Answer: " + item.opts[item.ans];
              q.appendChild(ak);
            }
          } else if (item.type === "fill") {
            const inp = q.querySelector("input");
            const val = inp.value.trim().toLowerCase();
            const ansNorm = item.ans.trim().toLowerCase();
            if (val === ansNorm) {
              q.classList.add("correct");
              correctCount++;
            } else {
              q.classList.add("incorrect");
              const ak = document.createElement("div");
              ak.className = "answer-key";
              ak.textContent = "Answer: " + item.ans;
              q.appendChild(ak);
            }
          }
        });

        // ---- Part5 ----
        data.part5.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const inp = q.querySelector("input");
          const val = inp.value.trim().toLowerCase();
          const ans = item.ans.trim().toLowerCase();
          if (val === ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.ans;
            q.appendChild(ak);
          }
        });

        // ---- Part6 ----
        data.part6.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const drop = q.querySelector(".dropzone");
          const parts = Array.from(drop.children).map((n) =>
            n.textContent.trim()
          );
          const sentence = parts.join(" ").replace(/\s+/g, " ").trim();
          const ansNorm = item.q.replace(/\s+/g, " ").trim();
          const sNorm = sentence.toLowerCase().replace(/\s+/g, " ").trim();
          const aNorm = ansNorm.toLowerCase().replace(/\s+/g, " ").trim();
          if (sNorm === aNorm) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.q;
            q.appendChild(ak);
          }
        });

        // --- Update score ---
        document.getElementById(
          "scoreDisplay"
        ).textContent = `Score: ${correctCount} / ${total}`;
      }

      // --- Reset ---
      function resetAll() {
        document.getElementById("scoreDisplay").textContent = "";
        renderAll();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // --- Render All ---
      function renderAll() {
        renderPart1();
        renderPart2();
        renderPart3();
        renderPart4();
        renderPart5();
        renderPart6();
      }

      // --- Init ---
      renderAll();

      // --- Menu buttons ---
      document.getElementById("showScoreBtn").onclick = () => checkAnswers();
      document.getElementById("redoBtn").onclick = () => resetAll();
      document.getElementById("toggleAnsBtn").onclick = () => {
        if (!document.querySelector(".answer-key")) {
          checkAnswers();
        }
        document.querySelectorAll(".answer-key").forEach((el) => {
          el.style.display =
            el.style.display === "none" || el.style.display === ""
              ? "block"
              : "none";
        });
      };
    </script>
  </body>
</html>
