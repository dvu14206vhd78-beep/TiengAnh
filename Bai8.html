<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tiếng Anh Bài 8</title>
    <style>
      :root {
        --ok: #d4edda;
        --bad: #f8d7da;
        --muted: #666;
        --primary: #0d6efd;
        --secondary: #6c757d;
        --bg: #f4f8fb;
        --card-bg: #fff;
      }
      body {
        font-family: Inter, Roboto, Arial, sans-serif;
        max-width: 1100px;
        margin: 0 auto;
        padding: 0;
        background: var(--bg);
        color: #111;
      }

      /* Top Menu */
      .top-menu {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #e6f7ff;
        padding: 14px 20px;
        border-bottom: 2px solid #d0ebff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .menu-title {
        font-size: 1.25em;
        font-weight: 600;
        color: #0d6efd;
      }

      .menu-buttons {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .menu-buttons .btn {
        padding: 8px 14px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 0.95em;
        font-weight: 500;
        transition: background 0.2s ease, transform 0.1s ease;
      }

      .menu-buttons .btn.primary {
        background: var(--primary);
        color: #fff;
      }

      .menu-buttons .btn.secondary {
        background: var(--secondary);
        color: #fff;
      }

      .menu-buttons .btn:hover {
        opacity: 0.9;
        transform: scale(1.03);
      }

      #scoreDisplay {
        font-weight: 700;
        margin-left: 12px;
        color: #333;
      }

      /* Main Container */
      h1 {
        margin: 20px 0;
        text-align: center;
      }

      h2 {
        margin-top: 30px;
        color: #0d6efd;
        border-bottom: 2px solid #d0ebff;
        padding-bottom: 4px;
      }

      .container {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        margin: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      /* Question block */
      .question {
        padding: 14px;
        border-radius: 10px;
        margin: 14px 0;
        border: 1px solid #eee;
        background: #fafafa;
        transition: 0.2s ease;
      }

      .question:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .q-title {
        font-weight: 600;
        margin-bottom: 8px;
      }

      .options label {
        display: block;
        margin: 8px 0;
        padding: 6px 10px;
        border-radius: 6px;
        transition: background 0.2s ease;
      }

      .options label:hover {
        background: #c5d4fa;
      }

      input[type="text"] {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        width: 100%;
        box-sizing: border-box;
      }

      .answer-key {
        margin-top: 8px;
        font-size: 0.95em;
        color: var(--muted);
      }

      .correct {
        background: var(--ok) !important;
      }

      .incorrect {
        background: var(--bad) !important;
      }

      /* Drag & drop */
      .word-bank {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px;
        border: 1px dashed #ccc;
        border-radius: 8px;
        min-height: 48px;
        background: #fff;
      }

      .word {
        background: #f0f0f0;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: grab;
        border: 1px solid #d0d0d0;
      }

      .dropzone {
        min-height: 48px;
        padding: 8px;
        border: 1px dashed #bbb;
        border-radius: 8px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        background: #fff;
      }

      .small {
        font-size: 0.95em;
        color: var(--muted);
        margin-bottom: 6px;
      }

      .passage {
        background: #fdfdfd;
        border-left: 4px solid #0d6efd;
        padding: 12px;
        margin: 14px 0;
        border-radius: 6px;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <!-- Menu trên cùng -->
    <div class="top-menu">
      <div class="menu-title">Ôn tập Tiếng Anh Bài 8</div>
      <div class="menu-buttons">
        <button class="btn primary" id="showScoreBtn">Xem kết quả</button>
        <button
          class="btn secondary"
          id="redoBtn"
          style="background-color: #111"
        >
          Làm lại & đảo câu
        </button>
        <button class="btn secondary" id="toggleAnsBtn">
          Hiện/ẩn đáp án đúng
        </button>
        <span id="scoreDisplay"></span>
      </div>
    </div>

    <div class="container">
      <h2>Part 1</h2>
      <div id="part1"></div>

      <h2>Part 2</h2>
      <div id="part2"></div>

      <h2>Part 3</h2>
      <div id="part3"></div>

      <h2>Part 4</h2>
      <div id="part4"></div>

      <h2>Part 5</h2>
      <div id="part5"></div>

      <h2>Part 6</h2>
      <div id="part6"></div>
    </div>

    <script>
      // --- Data ---
      const data = {
        part1: [
          {
            id: "p1q1",
            q: "Nhân viên phải thay đổi mật khẩu của họ mỗi tháng một lần.",
            opts: [
              "Staff must change their passwords once a month.",
              "Staff should share passwords with others once a month.",
              "Staff can skip updating their passwords once a month.",
            ],
            ans: 0,
          },
          {
            id: "p1q2",
            q: "Bộ phần R&D phát triển sản phẩm mới và cải tiến công nghê.",
            opts: [
              "The R&D Department works with new customers everyday.",
              "The R&D Department arranges team meeting and interviews.",
              "The R&D Department develops new product and improves technology.",
            ],
            ans: 2,
          },
          {
            id: "p1q3",
            q: "Phòng Nhân sự chịu trách nhiệm tuyển dụng và hỗ trợ nhân viên.",
            opts: [
              "The IT Department installs operating systems and firewalls.",
              "The Sales Department builds and repairs computer equipment.",
              "The H.R Department is responsible for hiring and supporting employees.",
            ],
            ans: 2,
          },
          {
            id: "p1q4",
            q: "Bạn không được phép kết nối thiết bị cá nhân vào máy tính văn phòng.",
            opts: [
              "You must not save your personal files on the office server.",
              "You must not connect personal phones to office computers.",
              "You must not connect personal devices to office computers.",
            ],
            ans: 2,
          },
        ],

        part2: [
          {
            id: "p2q1",
            q: "Anna……manage customer issues directly because she’s in Customer Service.",
            opts: ["must", "mustn’t", "doesn’t have to"],
            ans: 0,
          },
          {
            id: "p2q2",
            q: "Staff in the Human Resources Department…… be responsible for hiring new employees.",
            opts: ["have to", "mustn’t", "don’t have to"],
            ans: 0,
          },
          {
            id: "p2q3",
            q: "Interns…..install software without permission from the person in the charge of IT.",
            opts: ["mustn’t", "have to", "don’t have to"],
            ans: 0,
          },
          {
            id: "p2q4",
            q: "Staff…………….follow IT Department rules to keep company networks secure.",
            opts: ["mustn't", "don't have to", "must"],
            ans: 2,
          },
          {
            id: "p2q5",
            q: "………employees...............all meetings organized by the Board of Directors?",
            opts: [
              "Do/ have attend",
              "Do/ have to attend",
              "Does/ have to attend",
            ],
            ans: 1,
          },
        ],

        part3: [
          {
            id: "p3q1",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Microsoft develops global software solutions. The R&D Department creates tools like AI and cloud platforms. IT Department supports systems and keeps data safe. Staff mustn’t share passwords and should report problems. The Board of Directors manages strategy. Sales sells products to clients. Marketing promotes services worldwide. Customer Services assists millions of customers daily with technical support.",
            q: "What responsibilities does the R&D Department at Microsoft have ?",
            opts: [
              "Creating tools like AI and cloud platforms",
              "Selling services to international clients",
              "Assisting customers with product support",
            ],
            ans: 0,
          },
          {
            id: "p3q2",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Canon Vietnam has factories producing printers. The R&D Department develops new technology. Human Resources hires staff and coordinates training. The IT Department manages the network and ensures safety. Employees must follow strict rules and should attend all meetings. They also have to connect to secure networks. Marketing promotes products, while Communication coordinates messages. The person in charge of IT helps maintain secure operations.",
            q: "What do Canon Vietnam employees have to do to follow company safety and teamwork rules?",
            opts: [
              "Install marketing software and promote new products",
              "Skip meetings and use open wireless networks",
              "Connect to secure networks and attend scheduled meetings",
            ],
            ans: 2,
          },
          {
            id: "p3q3",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Canon Vietnam has factories producing printers. The R&D Department develops new technology. Human Resources hires staff and coordinates training. The IT Department manages the network and ensures safety. Employees must follow strict rules and should attend all meetings. They also have to connect to secure networks. Marketing promotes products, while Communication coordinates messages. The person in charge of IT helps maintain secure operations.",
            q: "What must Canon employees do to follow company technology and teamwork policies ?",
            opts: [
              "Use personal USB drives and skip communication meetings",
              "Follow safety rules, attend meetings, and use secure networks",
              "Wear badges, attend meetings, and avoid system updates",
            ],
            ans: 1,
          },
          {
            id: "p3q4",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Panasonic Vietnam sells electronics through its Sales Department and promotes them via Marketing. The IT Department supports employees and protects data. Workers must follow rules, including not installing software. The Accounting Department records financial data, and Customer Services assists customers. Human Resources hires staff and manages training. The company must keep its operations secure and efficient.",
            q: "Why is the IT Department important at Panasonic Vietnam?",
            opts: [
              "It trains new staff and hires technical workers",
              "It supports staff and ensures systems are securely managed",
              "It helps the Accounting Department record company finances",
            ],
            ans: 1,
          },
          {
            id: "p3q5",
            instruction:
              "Read the passage and choose the correct answer to the question.",
            passage:
              "Foxconn has global factories producing electronics. The IT Department manages networks and keeps systems safe. The R&D Department researches production methods. Staff must wear ID badges and mustn't use personal devices. Human Resources hires and trains employees. The Board of Directors plans strategy. The Communication Department coordinates updates and supports internal communication across departments.",
            q: "How does Foxconn ensure workplace safety and communication across departments?",
            opts: [
              "By selling products globally and training its sales team",
              "By promoting employee sales and increasing factory output",
              "By coordinating updates through Communication and enforcing IT rules",
            ],
            ans: 2,
          },
        ],

        part4: [
          {
            id: "p4q1",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "Canon Vietnam has factories producing printers. The R&D Department develops new technology. Human Resources hires staff and coordinates training. The IT Department manages the network and ensures safety. Employees must follow strict rules and should attend all meetings. They also have to connect to secure networks. Marketing promotes products, while Communication coordinates messages. The person in charge of IT helps maintain secure operations.",
            q: "Employees are expected to attend team meetings regulary.",
            type: "tf",
            opts: ["True", "False"],
            ans: 0,
          },
          {
            id: "p4q2",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "Microsoft develops global software solutions. The R&D Department creates tools like AI and cloud platforms. IT Department supports systems and keeps data safe. Staff mustn’t share passwords and should report problems. The Board of Directors manages strategy. Sales sells products to clients. Marketing promotes services worldwide. Customer Services assists millions of customers daily with technical support.",
            q: "Employees must report system problems and avoid sharing passwords.",
            type: "tf",
            opts: ["True", "False"],
            ans: 0,
          },
          {
            id: "p4q3",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "Panasonic Vietnam sells electronics through its Sales Department and promotes them via Marketing. The IT Department supports employees and protects data. Workers must follow rules, including not installing software. The Accounting Department records financial data, and Customer Services assists customers. Human Resources hires staff and manages training. The company must keep its operations secure and efficient.",
            q: "Customer Services is responsible for managing company sales and advertising.",
            type: "tf",
            opts: ["True", "False"],
            ans: 1,
          },
          {
            id: "p4q4",
            instruction:
              "Fill in the blank with TWO or THREE words from the text to complete the summary.",
            passage:
              "Samsung Electronics Vietnam has large factories producing electronic devices for global markets. The Human Resources department hires and trains staff to ensure efficient operations. Employees must follow safety rules and mustn't bring food near equipment. The Accounting Department records financial transactions, while Customer Services assists users. Marketing promotes new products, and Communication manages internal updates. IT supports staff and secures company networks daily.",
            q: "Summary: Samsung Electronics Vietnam produces electronics and has strict workplace rules. The Communication Department handles updates, and the ________ ensures staff are trained for smooth factory operations.",
            type: "fill",
            ans: "Human Resources Department",
          },
          {
            id: "p4q5",
            instruction:
              "Fill in the blank with TWO or THREE words from the text to complete the summary.",
            passage:
              "Foxconn has global factories producing electronics for leading technology brands. The IT Department manages computer networks and ensures system remains secure. The R&D Department researches advanced production methods. Employees must wear ID badges and mustn't use personal devices at work. Human Resources hires and trains staff. The Board of Directors sets company strategy, while Communication coordinates updates and supports internal communication.",
            q: "Summary: Foxconn produces electronics in global factories and ensures system safety through its IT Department. Staff must follow security rules like wearing ID badges and not using _______. Communication supports internal messaging, while the Board guides overall company strategy.",
            type: "fill",
            ans: "personal devices",
          },
          {
            id: "p4q6",
            instruction:
              "Fill in the blank with TWO or THREE words from the text to complete the summary.",
            passage:
              "Canon Vietnam has factories producing printers. The R&D Department develops new technology. Human Resources hires staff and coordinates training. The IT Department manages the network and ensures safety. Employees must follow strict rules and should attend all meetings. They also have to connect to secure networks. Marketing promotes products, while Communication coordinates messages. The person in charge of information technology helps maintain secure operations.",
            q: "Summary: Canon Vietnam produces printers in its factories. The IT Department ensures network safety and is supported by the................of IT. Employees follow strict rules, attend meetings, and use secure connections.",
            type: "fill",
            ans: "person in charge",
          },
        ],

        part5: [
          {
            id: "p5q1",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts",
            q: "You _______to the Board of Directors when planning the company's IT projects to get useful directions. (must / report / problem)",
            ans: "must report problems",
          },
          {
            id: "p5q2",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "Anna ________ quickly when she receives urgent updates from the Marketing Department. (have to / coordinate)",
            ans: "has to coordinate",
          },
          {
            id: "p5q3",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "Staff _______to maintain a good relationship in the IT workspace. (must / support / other)",
            ans: "must support each other",
          },
          {
            id: "p5q4",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "She.................all financial transactions by the end of each working day.( not/ have to/ record )",
            ans: "doesn't have to record",
          },
          {
            id: "p5q5",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "Do we………………..when the client database is down?(have/ support/ customers)",
            ans: "have to support customers",
          },
        ],

        part6: [
          {
            id: "p6q1",
            q: "Do employees in the Sales Department have to record every transaction accurately and promptly?",
            words: [
              "have",
              "Do",
              "Sales Department",
              "employees in the",
              "record",
              "to",
              "and promptly?",
              "every transaction accurately",
            ],
          },
          {
            id: "p6q2",
            q: "Do we have to support our colleagues in the R&D Department during new product research projects?",
            words: [
              "we",
              "in the R&D",
              "have to",
              "Department",
              "new product",
              "Do",
              "during",
              "support",
              "our colleagues",
              "research projects?",
            ],
          },
          {
            id: "p6q3",
            q: "Must he attend meetings regulary with the Board of Directors and present financial reports?",
            words: [
              "meetings",
              "and present",
              "attend",
              "regularly with",
              "of Directors",
              "he",
              "financial reports?",
              "Must",
              "the Board",
            ],
          },
          {
            id: "p6q4",
            q: "Anna doesn't have to coordinate with the Communication Department to promote the new software products.",
            words: [
              "to promote",
              "The Communication Department",
              "products.",
              "doesn't",
              "coordinate with",
              "have to",
              "the new",
              "software",
              "Anna",
            ],
          },
          {
            id: "p6q5",
            q: "You mustn't share your password with people you work with because of IT security regulations.",
            words: [
              "people you",
              "share",
              "your password",
              "You",
              "with",
              "IT security",
              "regulations.",
              "work with",
              "mustn't",
            ],
          },
        ],
      };

      // --- Utility ---
      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      // --- Render Part1 ---
      function renderPart1() {
        const el = document.getElementById("part1");
        el.innerHTML = "";
        data.part1.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part2 ---
      function renderPart2() {
        const el = document.getElementById("part2");
        el.innerHTML = "";
        data.part2.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part3 ---
      function renderPart3() {
        const el = document.getElementById("part3");
        el.innerHTML = "";
        data.part3.forEach((item, idx) => {
          if (item.instruction) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.instruction;
            el.appendChild(instr);
          }
          if (item.passage) {
            const passage = document.createElement("div");
            passage.className = "passage";
            passage.textContent = item.passage;
            el.appendChild(passage);
          }
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part4 ---
      function renderPart4() {
        const el = document.getElementById("part4");
        el.innerHTML = "";
        data.part4.forEach((item, idx) => {
          if (item.instruction) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.instruction;
            el.appendChild(instr);
          }
          if (item.passage) {
            const passage = document.createElement("div");
            passage.className = "passage";
            passage.textContent = item.passage;
            el.appendChild(passage);
          }
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          if (item.type === "tf") {
            const opts = document.createElement("div");
            opts.className = "options";
            item.opts.forEach((opt, i) => {
              const label = document.createElement("label");
              const r = document.createElement("input");
              r.type = "radio";
              r.name = item.id;
              r.value = i;
              label.appendChild(r);
              label.append(" " + opt);
              opts.appendChild(label);
            });
            q.appendChild(opts);
          } else if (item.type === "fill") {
            const inp = document.createElement("input");
            inp.type = "text";
            inp.name = item.id;
            q.appendChild(inp);
          }
          el.appendChild(q);
        });
      }

      // --- Render Part5 ---
      function renderPart5() {
        const el = document.getElementById("part5");
        el.innerHTML = "";
        data.part5.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          if (item.p) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.p;
            q.appendChild(instr);
          }
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const inp = document.createElement("input");
          inp.type = "text";
          inp.name = item.id;
          q.appendChild(inp);
          el.appendChild(q);
        });
      }

      // --- Render Part6 ---
      function renderPart6() {
        const el = document.getElementById("part6");
        el.innerHTML = "";
        data.part6.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          q.dataset.answer = item.q;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 13 + ". Put the words in order.";
          q.appendChild(title);
          const bank = document.createElement("div");
          bank.className = "word-bank";
          bank.dataset.qid = item.id;
          q.appendChild(bank);
          const drop = document.createElement("div");
          drop.className = "dropzone";
          drop.dataset.qid = item.id;
          q.appendChild(drop);
          el.appendChild(q);
          const words = Array.from(item.words);
          shuffle(words);
          words.forEach((w) => {
            const d = document.createElement("div");
            d.className = "word";
            d.draggable = true;
            d.textContent = w;
            d.addEventListener("dragstart", (ev) => {
              ev.dataTransfer.setData(
                "text/plain",
                JSON.stringify({ qid: item.id, text: w, src: "bank" })
              );
            });
            bank.appendChild(d);
          });
          drop.addEventListener("dragover", (ev) => ev.preventDefault());
          drop.addEventListener("drop", (ev) => {
            ev.preventDefault();
            const payload = JSON.parse(ev.dataTransfer.getData("text/plain"));
            const text = payload.text;
            const fromBank = [
              ...document.querySelectorAll("#" + item.id + " .word-bank .word"),
            ];
            let movedEl = fromBank.find((n) => n.textContent === text);
            if (movedEl) {
              const clone = movedEl.cloneNode(true);
              attachDragForPlaced(clone);
              drop.appendChild(clone);
              movedEl.remove();
              // --- Cho phép kéo từ dropzone trả lại word-bank ---
              bank.addEventListener("dragover", (ev) => ev.preventDefault());
              bank.addEventListener("drop", (ev) => {
                ev.preventDefault();
                const payload = JSON.parse(
                  ev.dataTransfer.getData("text/plain")
                );
                const text = payload.text;
                const fromDrop = [
                  ...document.querySelectorAll(
                    "#" + item.id + " .dropzone .word"
                  ),
                ];
                let movedEl = fromDrop.find((n) => n.textContent === text);
                if (movedEl) {
                  const clone = movedEl.cloneNode(true);
                  clone.draggable = true;
                  clone.addEventListener("dragstart", (ev2) => {
                    ev2.dataTransfer.setData(
                      "text/plain",
                      JSON.stringify({ qid: item.id, text: text, src: "bank" })
                    );
                  });
                  bank.appendChild(clone);
                  movedEl.remove();
                }
              });
            }
          });
        });
      }

      function attachDragForPlaced(el) {
        el.addEventListener("dragstart", (ev) => {
          const parentQ = ev.target.closest(".question");
          ev.dataTransfer.setData(
            "text/plain",
            JSON.stringify({
              qid: parentQ.id,
              text: ev.target.textContent,
              src: "placed",
            })
          );
        });
      }

      // --- Check Answers ---
      function checkAnswers() {
        document.querySelectorAll(".question").forEach((q) => {
          q.classList.remove("correct", "incorrect");
          q.querySelectorAll(".answer-key").forEach((a) => a.remove());
        });
        let total = 0,
          correctCount = 0;

        // ---- Part1 ----
        data.part1.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part2 ----
        data.part2.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part3 ----
        data.part3.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part4 ----
        data.part4.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          if (item.type === "tf") {
            const sel = q.querySelector("input[type=radio]:checked");
            if (sel && Number(sel.value) === item.ans) {
              q.classList.add("correct");
              correctCount++;
            } else {
              q.classList.add("incorrect");
              const ak = document.createElement("div");
              ak.className = "answer-key";
              ak.textContent = "Answer: " + item.opts[item.ans];
              q.appendChild(ak);
            }
          } else if (item.type === "fill") {
            const inp = q.querySelector("input");
            const val = inp.value.trim().toLowerCase();
            const ansNorm = item.ans.trim().toLowerCase();
            if (val === ansNorm) {
              q.classList.add("correct");
              correctCount++;
            } else {
              q.classList.add("incorrect");
              const ak = document.createElement("div");
              ak.className = "answer-key";
              ak.textContent = "Answer: " + item.ans;
              q.appendChild(ak);
            }
          }
        });

        // ---- Part5 ----
        data.part5.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const inp = q.querySelector("input");
          const val = inp.value.trim().toLowerCase();
          const ans = item.ans.trim().toLowerCase();
          if (val === ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.ans;
            q.appendChild(ak);
          }
        });

        // ---- Part6 ----
        data.part6.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const drop = q.querySelector(".dropzone");
          const parts = Array.from(drop.children).map((n) =>
            n.textContent.trim()
          );
          const sentence = parts.join(" ").replace(/\s+/g, " ").trim();
          const ansNorm = item.q.replace(/\s+/g, " ").trim();
          const sNorm = sentence.toLowerCase().replace(/\s+/g, " ").trim();
          const aNorm = ansNorm.toLowerCase().replace(/\s+/g, " ").trim();
          if (sNorm === aNorm) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.q;
            q.appendChild(ak);
          }
        });

        // --- Update score ---
        document.getElementById(
          "scoreDisplay"
        ).textContent = `Score: ${correctCount} / ${total}`;
      }

      // --- Reset ---
      function resetAll() {
        document.getElementById("scoreDisplay").textContent = "";
        renderAll();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // --- Render All ---
      function renderAll() {
        renderPart1();
        renderPart2();
        renderPart3();
        renderPart4();
        renderPart5();
        renderPart6();
      }

      // --- Init ---
      renderAll();

      // --- Menu buttons ---
      document.getElementById("showScoreBtn").onclick = () => checkAnswers();
      document.getElementById("redoBtn").onclick = () => resetAll();
      document.getElementById("toggleAnsBtn").onclick = () => {
        if (!document.querySelector(".answer-key")) {
          checkAnswers();
        }
        document.querySelectorAll(".answer-key").forEach((el) => {
          el.style.display =
            el.style.display === "none" || el.style.display === ""
              ? "block"
              : "none";
        });
      };
    </script>
  </body>
</html>
