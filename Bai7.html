<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tiếng Anh Bài 1</title>
    <style>
      :root {
        --ok: #d4edda;
        --bad: #f8d7da;
        --muted: #666;
        --primary: #0d6efd;
        --secondary: #6c757d;
        --bg: #f4f8fb;
        --card-bg: #fff;
      }
      body {
        font-family: Inter, Roboto, Arial, sans-serif;
        max-width: 1100px;
        margin: 0 auto;
        padding: 0;
        background: var(--bg);
        color: #111;
      }

      /* Top Menu */
      .top-menu {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #e6f7ff;
        padding: 14px 20px;
        border-bottom: 2px solid #d0ebff;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .menu-title {
        font-size: 1.25em;
        font-weight: 600;
        color: #0d6efd;
      }

      .menu-buttons {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .menu-buttons .btn {
        padding: 8px 14px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-size: 0.95em;
        font-weight: 500;
        transition: background 0.2s ease, transform 0.1s ease;
      }

      .menu-buttons .btn.primary {
        background: var(--primary);
        color: #fff;
      }

      .menu-buttons .btn.secondary {
        background: var(--secondary);
        color: #fff;
      }

      .menu-buttons .btn:hover {
        opacity: 0.9;
        transform: scale(1.03);
      }

      #scoreDisplay {
        font-weight: 700;
        margin-left: 12px;
        color: #333;
      }

      /* Main Container */
      h1 {
        margin: 20px 0;
        text-align: center;
      }

      h2 {
        margin-top: 30px;
        color: #0d6efd;
        border-bottom: 2px solid #d0ebff;
        padding-bottom: 4px;
      }

      .container {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        margin: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      /* Question block */
      .question {
        padding: 14px;
        border-radius: 10px;
        margin: 14px 0;
        border: 1px solid #eee;
        background: #fafafa;
        transition: 0.2s ease;
      }

      .question:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .q-title {
        font-weight: 600;
        margin-bottom: 8px;
      }

      .options label {
        display: block;
        margin: 8px 0;
        padding: 6px 10px;
        border-radius: 6px;
        transition: background 0.2s ease;
      }

      .options label:hover {
        background: #f1f5ff;
      }

      input[type="text"] {
        padding: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        width: 100%;
        box-sizing: border-box;
      }

      .answer-key {
        margin-top: 8px;
        font-size: 0.95em;
        color: var(--muted);
      }

      .correct {
        background: var(--ok) !important;
      }

      .incorrect {
        background: var(--bad) !important;
      }

      /* Drag & drop */
      .word-bank {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 8px;
        border: 1px dashed #ccc;
        border-radius: 8px;
        min-height: 48px;
        background: #fff;
      }

      .word {
        background: #f0f0f0;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: grab;
        border: 1px solid #d0d0d0;
      }

      .dropzone {
        min-height: 48px;
        padding: 8px;
        border: 1px dashed #bbb;
        border-radius: 8px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        background: #fff;
      }

      .small {
        font-size: 0.95em;
        color: var(--muted);
        margin-bottom: 6px;
      }

      .passage {
        background: #fdfdfd;
        border-left: 4px solid #0d6efd;
        padding: 12px;
        margin: 14px 0;
        border-radius: 6px;
        white-space: pre-line;
      }
    </style>
  </head>
  <body>
    <!-- Menu trên cùng -->
    <div class="top-menu">
      <div class="menu-title">Ôn tập Tiếng Anh Bài 1</div>
      <div class="menu-buttons">
        <button class="btn primary" id="showScoreBtn">Xem kết quả</button>
        <button
          class="btn secondary"
          id="redoBtn"
          style="background-color: #111"
        >
          Làm lại & đảo câu
        </button>
        <button class="btn secondary" id="toggleAnsBtn">
          Hiện/ẩn đáp án đúng
        </button>
        <span id="scoreDisplay"></span>
      </div>
    </div>

    <div class="container">
      <h2>Part 1</h2>
      <div id="part1"></div>

      <h2>Part 2</h2>
      <div id="part2"></div>

      <h2>Part 3</h2>
      <div id="part3"></div>

      <h2>Part 4</h2>
      <div id="part4"></div>

      <h2>Part 5</h2>
      <div id="part5"></div>

      <h2>Part 6</h2>
      <div id="part6"></div>
    </div>

    <script>
      // --- Data ---
      const data = {
        part1: [
          {
            id: "p1q1",
            q: "CV của bạn nên trình bày rõ ràng kinh nghiệm làm việc.",
            opts: [
              "Your CV should clearly present work experience.",
              "Your CV should focus only on personal hobbies",
              "Your CV should be written in different colors.",
            ],
            ans: 0,
          },
          {
            id: "p1q2",
            q: "Chúng ta có thể sử dụng trí tuệ nhân tạo để phân tích dữ liệu.",
            opts: [
              "We can send data without using artificial intelligence.",
              "We can use artificial intelligence in data science.",
              "We can use artificial intelligence to analyze data.",
            ],
            ans: 2,
          },
          {
            id: "p1q3",
            q: "Bạn nên nói về kĩ năng và điểm mạnh trong buổi phỏng vấn.",
            opts: [
              "You should talk about your address and ID card.",
              "You should talk about skills and strengths in the interview.",
              "You should talk about hobbies and pets in the interview.",
            ],
            ans: 1,
          },
          {
            id: "p1q4",
            q: "Tôi từng làm việc tại một công ty phần mềm nổi tiếng.",
            opts: [
              "I will work at a famous software company.",
              "I used to work at a famous software company.",
              "I work at a famous software company now.",
            ],
            ans: 1,
          },
        ],

        part2: [
          {
            id: "p2q1",
            q: "He…. in hackathons, but now he prefers solo projects.",
            opts: [
              "used to participating",
              "used to participate",
              "have participated",
            ],
            ans: 1,
          },
          {
            id: "p2q2",
            q: "…..you…. in teams to develop a university scheduling system?",
            opts: [
              "did/ used to work",
              "did/ use to work",
              "has/ used to work",
            ],
            ans: 1,
          },
          {
            id: "p2q3",
            q: "……she ever….. a strong curriculum vitae for the internship program yet?",
            opts: ["Has/wrote", "Have/written", "Has/written"],
            ans: 2,
          },
          {
            id: "p2q4",
            q: "I …… send handwritten CVs, but now everything is online",
            opts: ["was used", "used to", "have used"],
            ans: 1,
          },
          {
            id: "p2q5",
            q: "She ….. as a support technician before becoming a developer.",
            opts: ["has work", "have worked", "has worked"],
            ans: 2,
          },
        ],

        part3: [
          {
            id: "p3q1",
            instruction:
              "Read the passage and choose the correct answer to each question.",
            passage:
              "InsightPro is hiring a Data Analyst to join our expanding team. The ideal candidate must have strong analytical skills, attention to detail, and be able to work under pressure. Responsibilities include analyzing large data sets, creating visuals, and preparing reports for management. Prior experience with Python or R is preferred. Applicants must submit a curriculum vitae with relevant qualifications and examples of previous projects. This is a full-time role with competitive salary and performance bonuses.",
            q: "How does InsightPro expect the candidate to support the company’s goals?",
            opts: [
              "By preparing reports and creating tools to present data clearly",
              "By working with customers to improve sales strantegies",
              "By designing websites and managing social medial platforms",
            ],
            ans: 0,
          },
          {
            id: "p3q2",
            instruction:
              "Read the passage and choose the correct answer to each question.",
            passage:
              "Last summer, I worked as an intern Software Developer at a local tech startup. I was responsible for small coding tasks and duties such as writing backend functions and fixing bugs. I used to struggle with teamwork, but during the internship I have improved my communication skills. I also participated in daily meetings and project planning. This experience helped me understand my strengths in problem-solving and the importance of being open to feedback.",
            q: "What does the intern’s experience suggest about learning in real projects?",
            opts: [
              "Real work experiences help improve soft skill like teamwork",
              "Writing code alone is enough to succeed in a company",
              "Technical skills are more important than communication.",
            ],
            ans: 0,
          },
          {
            id: "p3q3",
            instruction:
              "Read the passage and choose the correct answer to each question.",
            passage:
              "Linh is applying for her first job as an IT Support Technician. She has written her curriculum vitae carefully, listing her skills in troubleshooting, customer service, and basic networking. She has taken part in several university IT projects and has always enjoyed helping friends fix computer problems. Although she used to be shy, she has become more confident by practicing interview questions with her classmates. She hopes her strengths will help her succeed in the job.",
            q: "When did Linh become more confident in her communication?",
            opts: [
              "When she practiced interview questions with classmates",
              "After participating in interviews at several companies",
              "After working for two years in IT customer service",
            ],
            ans: 0,
          },
          {
            id: "p3q4",
            instruction:
              "Read the passage and choose the correct answer to each question.",
            passage:
              "I have just completed my application for a junior Software Developer role at FutureTech. I wrote a detailed curriculum vitae, describing my qualifications, work experience, and skills. I mentioned that I have developed several mobile apps during university and taken part in open-source projects. The most difficult part was the salary negotiation, as I didn't have much experience with that. However, I explained my strengths and potential to grow. I hope to hear back soon and be invited to an interview.",
            q: "What challenge did the applicant face during the job application process?",
            opts: [
              "Submitting a late curriculum vitae to the company",
              "Writing a cover letter for an foreign company",
              "Negotiating a salary without much prior experience",
            ],
            ans: 2,
          },
          {
            id: "p3q5",
            instruction:
              "Read the passage and choose the correct answer to each question.",
            passage:
              "Duy has recently been invited to an IT Support Technician job interview. He submitted his curriculum vitae last week and was selected as a strong candidate. During the interview, he was asked about his communication skills, how he handles technical issues, and whether he can work under pressure. Duy spoke confidently about his experience and strengths and even mentioned a past weakness—time management—which he has improved. He also shared that he used to work part-time as a help desk assistant while studying.",
            q: "What does Duy’s part-time job as a help desk assistant show about him?",
            opts: [
              "He lacks teamwork experience and prefers personal projects.",
              "He has real-world experience supporting users in technical environments.",
              "He prefers working independently without supervision.",
            ],
            ans: 1,
          },
        ],

        part4: [
          {
            id: "p4q1",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "Linh is applying for her first job as an IT Support Technician. She has written her curriculum vitae carefully, listing her skills in troubleshooting, customer service, and basic networking. She has taken part in several university IT projects and has always enjoyed helping friends fix computer problems. Although she used to be shy, she has become more confident by practicing interview questions with her classmates. She hopes her strengths will help her succeed in the job.",
            q: "Linh practiced interview questions with professionals at the company",
            type: "tf",
            opts: ["True", "False"],
            ans: 1,
          },
          {
            id: "p4q2",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "Last summer, I worked as an intern Software Developer at a local tech startup. I was responsible for small coding tasks and duties such as writing backend functions and fixing bugs. I used to struggle with teamwork, but during the internship I have improved my communication skills. I also participated in daily meetings and project planning. This experience helped me understand my strengths in problem-solving and the importance of being open to feedback.",
            q: "The intern worked on bug fixes and backend code during the intern ship",
            type: "tf",
            opts: ["True", "False"],
            ans: 0,
          },
          {
            id: "p4q3",
            instruction:
              "Read the passage. Decide if the statement is True or False based on the information from the text.",
            passage:
              "I have just completed my application for a junior Software Developer role at FutureTech. I wrote a detailed curriculum vitae, describing my qualifications, work experience, and skills. I mentioned that I have developed several mobile apps during university and taken part in open-source projects. The most difficult part was the salary negotiation, as I didn't have much experience with that. However, I explained my strengths and potential to grow. I hope to hear back soon and be invited to an interview.",
            q: "The applicant has developed mobile apps and participated in open-source projects.",
            type: "tf",
            opts: ["True", "False"],
            ans: 0,
          },
          {
            id: "p4q4",
            instruction:
              "Fill in the blank with TWO or THREE words from the text to complete the summary.",
            passage:
              "I have just completed my application for a junior Software Developer role at FutureTech. I wrote a detailed curriculum vitae, describing my qualifications, work experience, and skills. I mentioned that I have developed several mobile apps during university and taken part in open-source projects. The most difficult part was the salary negotiation, as I didn’t have much experience with that. However, I explained my strengths and potential to grow. I hope to hear back soon and be invited to an interview.",
            q: "Summary: The applicant included past development experience in their application and discussed the difficulty of ......................................., which he managed by explaining his strengths.",
            type: "fill",
            ans: "salary negotiation",
          },
          {
            id: "p4q5",
            instruction:
              "Fill in the blank with TWO or THREE words from the text to complete the summary.",
            passage:
              "Last summer, I worked as an intern Software Developer at a local tech startup. I was responsible for small coding tasks and duties such as writing backend functions and fixing bugs. I used to struggle with teamwork, but during the internship I have improved my communication skills. I also participated in daily meetings and project planning. This experience helped me understand my strengths in problem-solving and the importance of being open to feedback.",
            q: "Summary: The writer completed a summer internship as a Software Developer at a tech startup. They handled various coding ................................. and gradually improved their teamwork and communication. The experience helped them recognize their strengths and the value of feedback.",
            type: "fill",
            ans: "tasks and duties",
          },
          {
            id: "p4q6",
            instruction:
              "Fill in the blank with TWO or THREE words from the text to complete the summary.",
            passage:
              "Duy has recently been invited to an IT Support Technician job interview. He submitted his curriculum vitae last week and was selected as a strong candidate. During the interview, he was asked about his communication skills, how he handles technical issues, and whether he can work under pressure. Duy spoke confidently about his experience and strengths and even mentioned a past weakness—time management—which he has improved. He also shared that he used to work part-time as a help desk assistant while studying.",
            q: "Summary: Duy was selected for an interview and confidently discussed his background, including a _______, which he has worked to overcome.",
            type: "fill",
            ans: "time management",
          },
        ],

        part5: [
          {
            id: "p5q1",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "Have they _________technical interviews since they graduated from the IT program? (take)",
            ans: "taken part in",
          },
          {
            id: "p5q2",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "Ahmed _________teamwork because he used to prefer working on his own. (learn/ recently)",
            ans: "has recently learned about",
          },
          {
            id: "p5q3",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "We _______tasks and duties listed in a real IT job description. (never/ analyze/ have)",
            ans: "have never analyzed",
          },
          {
            id: "p5q4",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "I __________ curriculum vitae for at least five different job positions. (already / write)",
            ans: "have already written a",
          },
          {
            id: "p5q5",
            p: "Complete the sentence with THREE or FOUR WORDS using the given prompts.",
            q: "Anna _______ group interviews, but now she enjoys speaking with other candidates. (not / use to / enjoy)",
            ans: "didn't use to enjoy",
          },
        ],

        part6: [
          {
            id: "p6q1",
            q: "He used to ignore his weaknesses, but he has worked hard to improve them during training.",
            words: [
              "his weaknesses,",
              "He",
              "ignore",
              "has",
              "to",
              "used",
              "to improve",
              "hard",
              "during training.",
              "but he",
              "worked",
              "them",
            ],
          },
          {
            id: "p6q2",
            q: "I haven't written any detailed curriculum vitae to apply for a part-time internship position.",
            words: [
              "for",
              "to apply",
              "haven't",
              "vitae",
              "position.",
              "written",
              "part-time",
              "any",
              "curriculum",
              "a",
              "I",
              "detailed",
              "intership",
            ],
          },
          {
            id: "p6q3",
            q: "Ahmed has developed strong communication skills because he has worked on some group projects.",
            words: [
              "he has",
              "skills",
              "because",
              "Ahmed",
              "strong communication",
              "developed",
              "some group projects.",
              "has",
              "worked on",
            ],
          },
          {
            id: "p6q4",
            q: "They used to study different majors, but now they all work as IT support technicans.",
            words: [
              "as",
              "They",
              "IT support",
              "but now",
              "work",
              "to",
              "they all",
              "different majors,",
              "study",
              "technicans.",
              "used",
            ],
          },
          {
            id: "p6q5",
            q: "Have you ever taken part in a coding competition at your university or online?",
            words: [
              "or online?",
              "Have",
              "at your",
              "part",
              "taken",
              "you",
              "competition",
              "university",
              "a coding",
              "ever",
              "in",
            ],
          },
        ],
      };

      // --- Utility ---
      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      // --- Render Part1 ---
      function renderPart1() {
        const el = document.getElementById("part1");
        el.innerHTML = "";
        data.part1.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part2 ---
      function renderPart2() {
        const el = document.getElementById("part2");
        el.innerHTML = "";
        data.part2.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part3 ---
      function renderPart3() {
        const el = document.getElementById("part3");
        el.innerHTML = "";
        data.part3.forEach((item, idx) => {
          if (item.instruction) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.instruction;
            el.appendChild(instr);
          }
          if (item.passage) {
            const passage = document.createElement("div");
            passage.className = "passage";
            passage.textContent = item.passage;
            el.appendChild(passage);
          }
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const opts = document.createElement("div");
          opts.className = "options";
          const order = shuffle(item.opts.map((v, i) => ({ v, i }))).map(
            (o) => o.i
          );
          q.dataset.order = JSON.stringify(order);
          order.forEach((origIndex) => {
            const label = document.createElement("label");
            const r = document.createElement("input");
            r.type = "radio";
            r.name = item.id;
            r.value = origIndex;
            label.appendChild(r);
            label.append(" " + item.opts[origIndex]);
            opts.appendChild(label);
          });
          q.appendChild(opts);
          el.appendChild(q);
        });
      }

      // --- Render Part4 ---
      function renderPart4() {
        const el = document.getElementById("part4");
        el.innerHTML = "";
        data.part4.forEach((item, idx) => {
          if (item.instruction) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.instruction;
            el.appendChild(instr);
          }
          if (item.passage) {
            const passage = document.createElement("div");
            passage.className = "passage";
            passage.textContent = item.passage;
            el.appendChild(passage);
          }
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          if (item.type === "tf") {
            const opts = document.createElement("div");
            opts.className = "options";
            item.opts.forEach((opt, i) => {
              const label = document.createElement("label");
              const r = document.createElement("input");
              r.type = "radio";
              r.name = item.id;
              r.value = i;
              label.appendChild(r);
              label.append(" " + opt);
              opts.appendChild(label);
            });
            q.appendChild(opts);
          } else if (item.type === "fill") {
            const inp = document.createElement("input");
            inp.type = "text";
            inp.name = item.id;
            q.appendChild(inp);
          }
          el.appendChild(q);
        });
      }

      // --- Render Part5 ---
      function renderPart5() {
        const el = document.getElementById("part5");
        el.innerHTML = "";
        data.part5.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          if (item.p) {
            const instr = document.createElement("div");
            instr.className = "small";
            instr.textContent = item.p;
            q.appendChild(instr);
          }
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 1 + ". " + item.q;
          q.appendChild(title);
          const inp = document.createElement("input");
          inp.type = "text";
          inp.name = item.id;
          q.appendChild(inp);
          el.appendChild(q);
        });
      }

      // --- Render Part6 ---
      function renderPart6() {
        const el = document.getElementById("part6");
        el.innerHTML = "";
        data.part6.forEach((item, idx) => {
          const q = document.createElement("div");
          q.className = "question";
          q.id = item.id;
          q.dataset.answer = item.q;
          const title = document.createElement("div");
          title.className = "q-title";
          title.textContent = idx + 13 + ". Put the words in order.";
          q.appendChild(title);
          const bank = document.createElement("div");
          bank.className = "word-bank";
          bank.dataset.qid = item.id;
          q.appendChild(bank);
          const drop = document.createElement("div");
          drop.className = "dropzone";
          drop.dataset.qid = item.id;
          q.appendChild(drop);
          el.appendChild(q);
          const words = Array.from(item.words);
          shuffle(words);
          words.forEach((w) => {
            const d = document.createElement("div");
            d.className = "word";
            d.draggable = true;
            d.textContent = w;
            d.addEventListener("dragstart", (ev) => {
              ev.dataTransfer.setData(
                "text/plain",
                JSON.stringify({ qid: item.id, text: w, src: "bank" })
              );
            });
            bank.appendChild(d);
          });
          drop.addEventListener("dragover", (ev) => ev.preventDefault());
          drop.addEventListener("drop", (ev) => {
            ev.preventDefault();
            const payload = JSON.parse(ev.dataTransfer.getData("text/plain"));
            const text = payload.text;
            const fromBank = [
              ...document.querySelectorAll("#" + item.id + " .word-bank .word"),
            ];
            let movedEl = fromBank.find((n) => n.textContent === text);
            if (movedEl) {
              const clone = movedEl.cloneNode(true);
              attachDragForPlaced(clone);
              drop.appendChild(clone);
              movedEl.remove();
              // --- Cho phép kéo từ dropzone trả lại word-bank ---
              bank.addEventListener("dragover", (ev) => ev.preventDefault());
              bank.addEventListener("drop", (ev) => {
                ev.preventDefault();
                const payload = JSON.parse(
                  ev.dataTransfer.getData("text/plain")
                );
                const text = payload.text;
                const fromDrop = [
                  ...document.querySelectorAll(
                    "#" + item.id + " .dropzone .word"
                  ),
                ];
                let movedEl = fromDrop.find((n) => n.textContent === text);
                if (movedEl) {
                  const clone = movedEl.cloneNode(true);
                  clone.draggable = true;
                  clone.addEventListener("dragstart", (ev2) => {
                    ev2.dataTransfer.setData(
                      "text/plain",
                      JSON.stringify({ qid: item.id, text: text, src: "bank" })
                    );
                  });
                  bank.appendChild(clone);
                  movedEl.remove();
                }
              });
            }
          });
        });
      }

      function attachDragForPlaced(el) {
        el.addEventListener("dragstart", (ev) => {
          const parentQ = ev.target.closest(".question");
          ev.dataTransfer.setData(
            "text/plain",
            JSON.stringify({
              qid: parentQ.id,
              text: ev.target.textContent,
              src: "placed",
            })
          );
        });
      }

      // --- Check Answers ---
      function checkAnswers() {
        document.querySelectorAll(".question").forEach((q) => {
          q.classList.remove("correct", "incorrect");
          q.querySelectorAll(".answer-key").forEach((a) => a.remove());
        });
        let total = 0,
          correctCount = 0;

        // ---- Part1 ----
        data.part1.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part2 ----
        data.part2.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part3 ----
        data.part3.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const sel = q.querySelector("input[type=radio]:checked");
          if (sel && Number(sel.value) === item.ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.opts[item.ans];
            q.appendChild(ak);
          }
        });

        // ---- Part4 ----
        data.part4.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          if (item.type === "tf") {
            const sel = q.querySelector("input[type=radio]:checked");
            if (sel && Number(sel.value) === item.ans) {
              q.classList.add("correct");
              correctCount++;
            } else {
              q.classList.add("incorrect");
              const ak = document.createElement("div");
              ak.className = "answer-key";
              ak.textContent = "Answer: " + item.opts[item.ans];
              q.appendChild(ak);
            }
          } else if (item.type === "fill") {
            const inp = q.querySelector("input");
            const val = inp.value.trim().toLowerCase();
            const ansNorm = item.ans.trim().toLowerCase();
            if (val === ansNorm) {
              q.classList.add("correct");
              correctCount++;
            } else {
              q.classList.add("incorrect");
              const ak = document.createElement("div");
              ak.className = "answer-key";
              ak.textContent = "Answer: " + item.ans;
              q.appendChild(ak);
            }
          }
        });

        // ---- Part5 ----
        data.part5.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const inp = q.querySelector("input");
          const val = inp.value.trim().toLowerCase();
          const ans = item.ans.trim().toLowerCase();
          if (val === ans) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.ans;
            q.appendChild(ak);
          }
        });

        // ---- Part6 ----
        data.part6.forEach((item) => {
          total++;
          const q = document.getElementById(item.id);
          const drop = q.querySelector(".dropzone");
          const parts = Array.from(drop.children).map((n) =>
            n.textContent.trim()
          );
          const sentence = parts.join(" ").replace(/\s+/g, " ").trim();
          const ansNorm = item.q.replace(/\s+/g, " ").trim();
          const sNorm = sentence.toLowerCase().replace(/\s+/g, " ").trim();
          const aNorm = ansNorm.toLowerCase().replace(/\s+/g, " ").trim();
          if (sNorm === aNorm) {
            q.classList.add("correct");
            correctCount++;
          } else {
            q.classList.add("incorrect");
            const ak = document.createElement("div");
            ak.className = "answer-key";
            ak.textContent = "Answer: " + item.q;
            q.appendChild(ak);
          }
        });

        // --- Update score ---
        document.getElementById(
          "scoreDisplay"
        ).textContent = `Score: ${correctCount} / ${total}`;
      }

      // --- Reset ---
      function resetAll() {
        document.getElementById("scoreDisplay").textContent = "";
        renderAll();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // --- Render All ---
      function renderAll() {
        renderPart1();
        renderPart2();
        renderPart3();
        renderPart4();
        renderPart5();
        renderPart6();
      }

      // --- Init ---
      renderAll();

      // --- Menu buttons ---
      document.getElementById("showScoreBtn").onclick = () => checkAnswers();
      document.getElementById("redoBtn").onclick = () => resetAll();
      document.getElementById("toggleAnsBtn").onclick = () => {
        if (!document.querySelector(".answer-key")) {
          checkAnswers();
        }
        document.querySelectorAll(".answer-key").forEach((el) => {
          el.style.display =
            el.style.display === "none" || el.style.display === ""
              ? "block"
              : "none";
        });
      };
    </script>
  </body>
</html>

